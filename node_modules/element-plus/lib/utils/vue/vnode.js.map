{"version":3,"file":"vnode.js","sources":["../../../../../packages/utils/vue/vnode.ts"],"sourcesContent":["import {\n  Comment,\n  Fragment,\n  Text,\n  createBlock,\n  createCommentVNode,\n  isVNode,\n  openBlock,\n} from 'vue'\nimport { camelize } from '../strings'\nimport { isArray } from '../types'\nimport { hasOwn } from '../objects'\nimport { debugWarn } from '../error'\n\nimport type { VNode, VNodeChild, VNodeNormalizedChildren } from 'vue'\n\nconst SCOPE = 'utils/vue/vnode'\n\nexport enum PatchFlags {\n  TEXT = 1,\n  CLASS = 2,\n  STYLE = 4,\n  PROPS = 8,\n  FULL_PROPS = 16,\n  HYDRATE_EVENTS = 32,\n  STABLE_FRAGMENT = 64,\n  KEYED_FRAGMENT = 128,\n  UNKEYED_FRAGMENT = 256,\n  NEED_PATCH = 512,\n  DYNAMIC_SLOTS = 1024,\n  HOISTED = -1,\n  BAIL = -2,\n}\n\nexport type VNodeChildAtom = Exclude<VNodeChild, Array<any>>\nexport type RawSlots = Exclude<\n  VNodeNormalizedChildren,\n  Array<any> | null | string\n>\n\nexport function isFragment(node: VNode): boolean\nexport function isFragment(node: unknown): node is VNode\nexport function isFragment(node: unknown): node is VNode {\n  return isVNode(node) && node.type === Fragment\n}\n\nexport function isText(node: VNode): boolean\nexport function isText(node: unknown): node is VNode\nexport function isText(node: unknown): node is VNode {\n  return isVNode(node) && node.type === Text\n}\n\nexport function isComment(node: VNode): boolean\nexport function isComment(node: unknown): node is VNode\nexport function isComment(node: unknown): node is VNode {\n  return isVNode(node) && node.type === Comment\n}\n\nconst TEMPLATE = 'template'\nexport function isTemplate(node: VNode): boolean\nexport function isTemplate(node: unknown): node is VNode\nexport function isTemplate(node: unknown): node is VNode {\n  return isVNode(node) && node.type === TEMPLATE\n}\n\n/**\n * determine if the element is a valid element type rather than fragments and comment e.g. <template> v-if\n * @param node {VNode} node to be tested\n */\nexport function isValidElementNode(node: VNode): boolean\nexport function isValidElementNode(node: unknown): node is VNode\nexport function isValidElementNode(node: unknown): node is VNode {\n  return isVNode(node) && !isFragment(node) && !isComment(node)\n}\n\n/**\n * get a valid child node (not fragment nor comment)\n * @param node {VNode} node to be searched\n * @param depth {number} depth to be searched\n */\nfunction getChildren(\n  node: VNodeNormalizedChildren | VNodeChild,\n  depth: number\n): VNodeNormalizedChildren | VNodeChild {\n  if (isComment(node)) return\n  if (isFragment(node) || isTemplate(node)) {\n    return depth > 0 ? getFirstValidNode(node.children, depth - 1) : undefined\n  }\n  return node\n}\n\nexport const getFirstValidNode = (\n  nodes: VNodeNormalizedChildren,\n  maxDepth = 3\n) => {\n  if (isArray(nodes)) {\n    return getChildren(nodes[0], maxDepth)\n  } else {\n    return getChildren(nodes, maxDepth)\n  }\n}\n\nexport function renderIf(\n  condition: boolean,\n  ...args: Parameters<typeof createBlock>\n) {\n  return condition ? renderBlock(...args) : createCommentVNode('v-if', true)\n}\n\nexport function renderBlock(...args: Parameters<typeof createBlock>) {\n  return (openBlock(), createBlock(...args))\n}\n\nexport const getNormalizedProps = (node: VNode) => {\n  if (!isVNode(node)) {\n    debugWarn(SCOPE, '[getNormalizedProps] must be a VNode')\n    return {}\n  }\n\n  const raw = node.props || {}\n  const type = (isVNode(node.type) ? node.type.props : undefined) || {}\n  const props: Record<string, any> = {}\n\n  Object.keys(type).forEach((key) => {\n    if (hasOwn(type[key], 'default')) {\n      props[key] = type[key].default\n    }\n  })\n\n  Object.keys(raw).forEach((key) => {\n    props[camelize(key)] = raw[key]\n  })\n\n  return props\n}\n\nexport type FlattenVNodes = Array<VNodeChildAtom | RawSlots>\n\nexport const flattedChildren = (\n  children: FlattenVNodes | VNode | VNodeNormalizedChildren\n): FlattenVNodes => {\n  const vNodes = isArray(children) ? children : [children]\n  const result: FlattenVNodes = []\n\n  vNodes.forEach((child) => {\n    if (isArray(child)) {\n      result.push(...flattedChildren(child))\n    } else if (isVNode(child) && child.component?.subTree) {\n      result.push(child, ...flattedChildren(child.component.subTree))\n    } else if (isVNode(child) && isArray(child.children)) {\n      result.push(...flattedChildren(child.children))\n    } else if (isVNode(child) && child.shapeFlag === 2) {\n      // @ts-ignore\n      result.push(...flattedChildren(child.type()))\n    } else {\n      result.push(child)\n    }\n  })\n  return result\n}\n"],"names":["PatchFlags","isVNode","Fragment","Text","Comment","isArray","createCommentVNode","openBlock","createBlock","debugWarn","hasOwn","camelize"],"mappings":"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"}