{"version":3,"file":"index.js","sources":["../../../../../packages/hooks/use-focus-controller/index.ts"],"sourcesContent":["import {\n  getCurrentInstance,\n  onMounted,\n  ref,\n  shallowRef,\n  unref,\n  watch,\n} from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { isElement, isFocusable, isFunction } from '@element-plus/utils'\n\nimport type { ShallowRef } from 'vue'\nimport type { MaybeRef } from '@vueuse/core'\n\ninterface UseFocusControllerOptions {\n  disabled?: MaybeRef<boolean>\n  /**\n   * return true to cancel focus\n   * @param event FocusEvent\n   */\n  beforeFocus?: (event: FocusEvent) => boolean | undefined\n  afterFocus?: () => void\n  /**\n   * return true to cancel blur\n   * @param event FocusEvent\n   */\n  beforeBlur?: (event: FocusEvent) => boolean | undefined\n  afterBlur?: () => void\n}\n\nexport function useFocusController<T extends { focus: () => void }>(\n  target: ShallowRef<T | undefined>,\n  {\n    disabled,\n    beforeFocus,\n    afterFocus,\n    beforeBlur,\n    afterBlur,\n  }: UseFocusControllerOptions = {}\n) {\n  const instance = getCurrentInstance()!\n  const { emit } = instance\n  const wrapperRef = shallowRef<HTMLElement>()\n  const isFocused = ref(false)\n\n  const handleFocus = (event: FocusEvent) => {\n    const cancelFocus = isFunction(beforeFocus) ? beforeFocus(event) : false\n    if (unref(disabled) || isFocused.value || cancelFocus) return\n\n    isFocused.value = true\n    emit('focus', event)\n    afterFocus?.()\n  }\n\n  const handleBlur = (event: FocusEvent) => {\n    const cancelBlur = isFunction(beforeBlur) ? beforeBlur(event) : false\n    if (\n      unref(disabled) ||\n      (event.relatedTarget &&\n        wrapperRef.value?.contains(event.relatedTarget as Node)) ||\n      cancelBlur\n    )\n      return\n\n    isFocused.value = false\n    emit('blur', event)\n    afterBlur?.()\n  }\n\n  const handleClick = (event: Event) => {\n    if (\n      unref(disabled) ||\n      isFocusable(event.target as HTMLElement) ||\n      (wrapperRef.value?.contains(document.activeElement) &&\n        wrapperRef.value !== document.activeElement)\n    )\n      return\n\n    target.value?.focus()\n  }\n\n  watch([wrapperRef, () => unref(disabled)], ([el, disabled]) => {\n    if (!el) return\n    if (disabled) {\n      el.removeAttribute('tabindex')\n    } else {\n      el.setAttribute('tabindex', '-1')\n    }\n  })\n\n  useEventListener(wrapperRef, 'focus', handleFocus, true)\n  useEventListener(wrapperRef, 'blur', handleBlur, true)\n  useEventListener(wrapperRef, 'click', handleClick, true)\n\n  // only for test\n  if (process.env.NODE_ENV === 'test') {\n    onMounted(() => {\n      const targetEl = isElement(target.value)\n        ? target.value\n        : document.querySelector('input,textarea')\n\n      if (targetEl) {\n        useEventListener(targetEl, 'focus', handleFocus, true)\n        useEventListener(targetEl, 'blur', handleBlur, true)\n      }\n    })\n  }\n\n  return {\n    isFocused,\n    /** Avoid using wrapperRef and handleFocus/handleBlur together */\n    wrapperRef,\n    handleFocus,\n    handleBlur,\n  }\n}\n"],"names":["getCurrentInstance","shallowRef","ref","isFunction","unref","isFocusable","watch","disabled","useEventListener","onMounted","isElement"],"mappings":"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"}