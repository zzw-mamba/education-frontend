{"version":3,"file":"row.js","sources":["../../../../../../../packages/components/table-v2/src/components/row.tsx"],"sourcesContent":["import {\n  computed,\n  defineComponent,\n  inject,\n  nextTick,\n  onMounted,\n  ref,\n  unref,\n} from 'vue'\nimport { isArray, isFunction, isNumber } from '@element-plus/utils'\nimport { tableV2RowProps } from '../row'\nimport { TableV2InjectionKey } from '../tokens'\nimport { placeholderSign } from '../private'\n\nimport type { CSSProperties, RendererElement, RendererNode, VNode } from 'vue'\nimport type { RowEventHandlers, TableV2RowProps } from '../row'\n\ntype CustomizedCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[]\n\ntype DefaultCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[][]\n\ntype ColumnCellsType = DefaultCellsType | CustomizedCellsType\n\nconst useTableRow = (props: TableV2RowProps) => {\n  const { isScrolling } = inject(TableV2InjectionKey)!\n\n  const measured = ref(false)\n  const rowRef = ref<HTMLElement>()\n  const measurable = computed(() => {\n    return isNumber(props.estimatedRowHeight) && props.rowIndex >= 0\n  })\n\n  const doMeasure = (isInit = false) => {\n    const $rowRef = unref(rowRef)\n    if (!$rowRef) return\n    const { columns, onRowHeightChange, rowKey, rowIndex, style } = props\n    const { height } = $rowRef.getBoundingClientRect()\n    measured.value = true\n\n    nextTick(() => {\n      if (isInit || height !== Number.parseInt(style!.height as string)) {\n        const firstColumn = columns[0]\n        const isPlaceholder = firstColumn?.placeholderSign === placeholderSign\n        onRowHeightChange?.(\n          { rowKey, height, rowIndex },\n          firstColumn && !isPlaceholder && firstColumn.fixed\n        )\n      }\n    })\n  }\n\n  const eventHandlers = computed(() => {\n    const { rowData, rowIndex, rowKey, onRowHover } = props\n    const handlers = props.rowEventHandlers || ({} as RowEventHandlers)\n    const eventHandlers = {} as {\n      [key in keyof RowEventHandlers]: (e: Event) => void\n    }\n\n    Object.entries(handlers).forEach(([eventName, handler]) => {\n      if (isFunction(handler)) {\n        eventHandlers[eventName as keyof RowEventHandlers] = (event: Event) => {\n          handler({\n            event,\n            rowData,\n            rowIndex,\n            rowKey,\n          })\n        }\n      }\n    })\n\n    if (onRowHover) {\n      ;(\n        [\n          { name: 'onMouseleave', hovered: false },\n          { name: 'onMouseenter', hovered: true },\n        ] as const\n      ).forEach(({ name, hovered }) => {\n        const existedHandler = eventHandlers[name]\n        eventHandlers[name] = ((event: MouseEvent) => {\n          onRowHover({\n            event,\n            hovered,\n            rowData,\n            rowIndex,\n            rowKey,\n          })\n\n          existedHandler?.(event)\n        }) as any\n      })\n    }\n    return eventHandlers\n  })\n\n  const onExpand = (expanded: boolean) => {\n    const { onRowExpand, rowData, rowIndex, rowKey } = props\n\n    onRowExpand?.({\n      expanded,\n      rowData,\n      rowIndex,\n      rowKey,\n    })\n  }\n\n  onMounted(() => {\n    if (unref(measurable)) {\n      doMeasure(true)\n    }\n  })\n\n  return { isScrolling, measurable, measured, rowRef, eventHandlers, onExpand }\n}\n\nconst COMPONENT_NAME = 'ElTableV2TableRow'\n\nconst TableV2Row = defineComponent({\n  name: COMPONENT_NAME,\n  props: tableV2RowProps,\n  setup(props, { expose, slots, attrs }) {\n    const {\n      eventHandlers,\n      isScrolling,\n      measurable,\n      measured,\n      rowRef,\n\n      onExpand,\n    } = useTableRow(props)\n\n    expose({\n      /**\n       * @description manually dispatching expand action on row.\n       */\n      onExpand,\n    })\n\n    return () => {\n      const {\n        columns,\n        columnsStyles,\n        expandColumnKey,\n        depth,\n        rowData,\n        rowIndex,\n        style,\n      } = props\n\n      let ColumnCells: ColumnCellsType = columns.map((column, columnIndex) => {\n        const expandable =\n          isArray(rowData.children) &&\n          rowData.children.length > 0 &&\n          column.key === expandColumnKey\n\n        return slots.cell!({\n          column,\n          columns,\n          columnIndex,\n          depth,\n          style: columnsStyles[column.key!],\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n          expandIconProps: expandable\n            ? {\n                rowData,\n                rowIndex,\n                onExpand,\n              }\n            : undefined,\n        })\n      })\n\n      if (slots.row) {\n        ColumnCells = slots.row({\n          cells: ColumnCells.map((node) => {\n            if (isArray(node) && node.length === 1) {\n              return node[0]\n            }\n            return node\n          }),\n          style,\n          columns,\n          depth,\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n        })\n      }\n\n      if (unref(measurable)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { height, ...exceptHeightStyle } = style || {}\n        const _measured = unref(measured)\n        return (\n          <div\n            ref={rowRef}\n            class={props.class}\n            style={_measured ? style : exceptHeightStyle}\n            role=\"row\"\n            {...attrs}\n            {...unref(eventHandlers)}\n          >\n            {ColumnCells}\n          </div>\n        )\n      }\n\n      return (\n        <div\n          {...attrs}\n          ref={rowRef}\n          class={props.class}\n          style={style}\n          role=\"row\"\n          {...unref(eventHandlers)}\n        >\n          {ColumnCells}\n        </div>\n      )\n    }\n  },\n})\n\nexport default TableV2Row\n\nexport type TableV2RowCellRenderParam = {\n  column: TableV2RowProps['columns'][number]\n  columns: TableV2RowProps['columns']\n  columnIndex: number\n  depth: number\n  style: CSSProperties\n  rowData: any\n  rowIndex: number\n  isScrolling: boolean\n  expandIconProps?: {\n    rowData: any\n    rowIndex: number\n    onExpand: (expand: boolean) => void\n  }\n}\n"],"names":["useTableRow","props","isScrolling","inject","TableV2InjectionKey","measured","ref","rowRef","measurable","computed","isNumber","estimatedRowHeight","rowIndex","doMeasure","isInit","$rowRef","unref","columns","onRowHeightChange","rowKey","style","height","getBoundingClientRect","value","nextTick","Number","parseInt","firstColumn","isPlaceholder","placeholderSign","fixed","eventHandlers","rowData","onRowHover","handlers","rowEventHandlers","Object","entries","forEach","eventName","handler","isFunction","event","name","hovered","existedHandler","onExpand","expanded","onRowExpand","onMounted","COMPONENT_NAME","TableV2Row","defineComponent","tableV2RowProps","setup","expose","slots","attrs","columnsStyles","expandColumnKey","depth","ColumnCells","map","column","columnIndex","expandable","isArray","children","length","key","cell","expandIconProps","undefined","row","cells","node","exceptHeightStyle","_measured","_createVNode","_mergeProps","class"],"mappings":"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"}