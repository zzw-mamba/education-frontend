{"version":3,"file":"fixed-size-grid.js","sources":["../../../../../../../packages/components/virtual-list/src/components/fixed-size-grid.ts"],"sourcesContent":["import { isNumber, throwError } from '@element-plus/utils'\nimport createGrid from '../builders/build-grid'\nimport {\n  AUTO_ALIGNMENT,\n  CENTERED_ALIGNMENT,\n  END_ALIGNMENT,\n  SMART_ALIGNMENT,\n  START_ALIGNMENT,\n} from '../defaults'\n\nconst SCOPE = 'ElFixedSizeGrid'\n\nconst FixedSizeGrid = createGrid({\n  name: 'ElFixedSizeGrid',\n  getColumnPosition: ({ columnWidth }, index) => [\n    columnWidth as number,\n    index * (columnWidth as number),\n  ],\n\n  getRowPosition: ({ rowHeight }, index) => [\n    rowHeight as number,\n    index * (rowHeight as number),\n  ],\n\n  getEstimatedTotalHeight: ({ totalRow, rowHeight }) =>\n    (rowHeight as number) * totalRow,\n\n  getEstimatedTotalWidth: ({ totalColumn, columnWidth }) =>\n    (columnWidth as number) * totalColumn,\n\n  getColumnOffset: (\n    { totalColumn, columnWidth, width },\n    columnIndex,\n    alignment,\n    scrollLeft,\n    _,\n    scrollBarWidth\n  ) => {\n    width = Number(width)\n    const lastColumnOffset = Math.max(\n      0,\n      totalColumn * (columnWidth as number) - width\n    )\n    const maxOffset = Math.min(\n      lastColumnOffset,\n      columnIndex * (columnWidth as number)\n    )\n    const minOffset = Math.max(\n      0,\n      columnIndex * (columnWidth as number) -\n        width +\n        scrollBarWidth +\n        (columnWidth as number)\n    )\n\n    if (alignment === 'smart') {\n      if (scrollLeft >= minOffset - width && scrollLeft <= maxOffset + width) {\n        alignment = AUTO_ALIGNMENT\n      } else {\n        alignment = CENTERED_ALIGNMENT\n      }\n    }\n\n    switch (alignment) {\n      case START_ALIGNMENT:\n        return maxOffset\n      case END_ALIGNMENT:\n        return minOffset\n      case CENTERED_ALIGNMENT: {\n        const middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2)\n        if (middleOffset < Math.ceil(width / 2)) {\n          return 0\n        } else if (middleOffset > lastColumnOffset + Math.floor(width / 2)) {\n          return lastColumnOffset\n        } else {\n          return middleOffset\n        }\n      }\n      case AUTO_ALIGNMENT:\n      default:\n        if (scrollLeft >= minOffset && scrollLeft <= maxOffset) {\n          return scrollLeft\n        } else if (minOffset > maxOffset) {\n          return minOffset\n        } else if (scrollLeft < minOffset) {\n          return minOffset\n        } else {\n          return maxOffset\n        }\n    }\n  },\n\n  getRowOffset: (\n    { rowHeight, height, totalRow },\n    rowIndex,\n    align,\n    scrollTop,\n    _,\n    scrollBarWidth\n  ): number => {\n    height = Number(height)\n    const lastRowOffset = Math.max(0, totalRow * (rowHeight as number) - height)\n    const maxOffset = Math.min(lastRowOffset, rowIndex * (rowHeight as number))\n    const minOffset = Math.max(\n      0,\n      rowIndex * (rowHeight as number) -\n        height +\n        scrollBarWidth +\n        (rowHeight as number)\n    )\n\n    if (align === SMART_ALIGNMENT) {\n      if (scrollTop >= minOffset - height && scrollTop <= maxOffset + height) {\n        align = AUTO_ALIGNMENT\n      } else {\n        align = CENTERED_ALIGNMENT\n      }\n    }\n\n    switch (align) {\n      case START_ALIGNMENT:\n        return maxOffset\n      case END_ALIGNMENT:\n        return minOffset\n      case CENTERED_ALIGNMENT: {\n        const middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2)\n        if (middleOffset < Math.ceil(height / 2)) {\n          return 0\n        } else if (middleOffset > lastRowOffset + Math.floor(height / 2)) {\n          return lastRowOffset\n        } else {\n          return middleOffset\n        }\n      }\n      case AUTO_ALIGNMENT:\n      default:\n        if (scrollTop >= minOffset && scrollTop <= maxOffset) {\n          return scrollTop\n        } else if (minOffset > maxOffset) {\n          return minOffset\n        } else if (scrollTop < minOffset) {\n          return minOffset\n        } else {\n          return maxOffset\n        }\n    }\n  },\n\n  getColumnStartIndexForOffset: ({ columnWidth, totalColumn }, scrollLeft) =>\n    Math.max(\n      0,\n      Math.min(\n        totalColumn - 1,\n        Math.floor(scrollLeft / (columnWidth as number))\n      )\n    ),\n\n  getColumnStopIndexForStartIndex: (\n    { columnWidth, totalColumn, width },\n    startIndex: number,\n    scrollLeft: number\n  ): number => {\n    const left = startIndex * (columnWidth as number)\n    const visibleColumnsCount = Math.ceil(\n      ((width as number) + scrollLeft - left) / (columnWidth as number)\n    )\n    return Math.max(\n      0,\n      Math.min(totalColumn - 1, startIndex + visibleColumnsCount - 1)\n    )\n  },\n\n  getRowStartIndexForOffset: (\n    { rowHeight, totalRow },\n    scrollTop: number\n  ): number =>\n    Math.max(\n      0,\n      Math.min(totalRow - 1, Math.floor(scrollTop / (rowHeight as number)))\n    ),\n\n  getRowStopIndexForStartIndex: (\n    { rowHeight, totalRow, height },\n    startIndex: number,\n    scrollTop: number\n  ): number => {\n    const top = startIndex * (rowHeight as number)\n    const numVisibleRows = Math.ceil(\n      ((height as number) + scrollTop - top) / (rowHeight as number)\n    )\n    return Math.max(\n      0,\n      Math.min(\n        totalRow - 1,\n        startIndex + numVisibleRows - 1 // -1 is because stop index is inclusive\n      )\n    )\n  },\n  /**\n   * Fixed size grid does not need this cache\n   * Using any to bypass it, TODO: Using type inference to fix this.\n   */\n  initCache: () => undefined as any,\n\n  clearCache: true,\n\n  validateProps: ({ columnWidth, rowHeight }) => {\n    if (process.env.NODE_ENV !== 'production') {\n      if (!isNumber(columnWidth)) {\n        throwError(\n          SCOPE,\n          `\n          \"columnWidth\" must be passed as number,\n            instead ${typeof columnWidth} was given.\n        `\n        )\n      }\n\n      if (!isNumber(rowHeight)) {\n        throwError(\n          SCOPE,\n          `\n          \"columnWidth\" must be passed as number,\n            instead ${typeof rowHeight} was given.\n        `\n        )\n      }\n    }\n  },\n})\n\nexport default FixedSizeGrid\n"],"names":["createGrid","AUTO_ALIGNMENT","CENTERED_ALIGNMENT","START_ALIGNMENT","END_ALIGNMENT","SMART_ALIGNMENT","isNumber","throwError"],"mappings":";;;;;;;;;AAUA,MAAM,KAAQ,GAAA,iBAAA,CAAA;AAEd,MAAM,gBAAgBA,oBAAW,CAAA;AAAA,EAC/B,IAAM,EAAA,iBAAA;AAAA,EACN,iBAAmB,EAAA,CAAC,EAAE,WAAA,IAAe,KAAU,KAAA;AAAA,IAC7C,WAAA;AAAA,IACA,KAAS,GAAA,WAAA;AAAA,GACX;AAAA,EAEA,cAAgB,EAAA,CAAC,EAAE,SAAA,IAAa,KAAU,KAAA;AAAA,IACxC,SAAA;AAAA,IACA,KAAS,GAAA,SAAA;AAAA,GACX;AAAA,EAEA,yBAAyB,CAAC,EAAE,QAAU,EAAA,SAAA,OACnC,SAAuB,GAAA,QAAA;AAAA,EAE1B,wBAAwB,CAAC,EAAE,WAAa,EAAA,WAAA,OACrC,WAAyB,GAAA,WAAA;AAAA,EAE5B,eAAA,EAAiB,CACf,EAAE,WAAa,EAAA,WAAA,EAAa,KAAM,EAAA,EAClC,WACA,EAAA,SAAA,EACA,UACA,EAAA,CAAA,EACA,cACG,KAAA;AACH,IAAA,KAAA,GAAQ,OAAO,KAAK,CAAA,CAAA;AACpB,IAAA,MAAM,mBAAmB,IAAK,CAAA,GAAA;AAAA,MAC5B,CAAA;AAAA,MACA,cAAe,WAAyB,GAAA,KAAA;AAAA,KAC1C,CAAA;AACA,IAAA,MAAM,YAAY,IAAK,CAAA,GAAA;AAAA,MACrB,gBAAA;AAAA,MACA,WAAe,GAAA,WAAA;AAAA,KACjB,CAAA;AACA,IAAA,MAAM,YAAY,IAAK,CAAA,GAAA;AAAA,MACrB,CAAA;AAAA,MACA,WAAA,GAAe,WACb,GAAA,KAAA,GACA,cACC,GAAA,WAAA;AAAA,KACL,CAAA;AAEA,IAAA,IAAI,cAAc,OAAS,EAAA;AACzB,MAAA,IAAI,UAAc,IAAA,SAAA,GAAY,KAAS,IAAA,UAAA,IAAc,YAAY,KAAO,EAAA;AACtE,QAAY,SAAA,GAAAC,uBAAA,CAAA;AAAA,OACP,MAAA;AACL,QAAY,SAAA,GAAAC,2BAAA,CAAA;AAAA,OACd;AAAA,KACF;AAEA,IAAQ,QAAA,SAAA;AAAA,MACD,KAAAC,wBAAA;AACH,QAAO,OAAA,SAAA,CAAA;AAAA,MACJ,KAAAC,sBAAA;AACH,QAAO,OAAA,SAAA,CAAA;AAAA,MAAA,KACJF,2BAAoB,EAAA;AACvB,QAAA,MAAM,eAAe,IAAK,CAAA,KAAA,CAAM,SAAa,GAAA,CAAA,SAAA,GAAY,aAAa,CAAC,CAAA,CAAA;AACvE,QAAA,IAAI,YAAe,GAAA,IAAA,CAAK,IAAK,CAAA,KAAA,GAAQ,CAAC,CAAG,EAAA;AACvC,UAAO,OAAA,CAAA,CAAA;AAAA,mBACE,YAAe,GAAA,gBAAA,GAAmB,KAAK,KAAM,CAAA,KAAA,GAAQ,CAAC,CAAG,EAAA;AAClE,UAAO,OAAA,gBAAA,CAAA;AAAA,SACF,MAAA;AACL,UAAO,OAAA,YAAA,CAAA;AAAA,SACT;AAAA,OACF;AAAA,MACK,KAAAD,uBAAA,CAAA;AAAA,MAAA;AAEH,QAAI,IAAA,UAAA,IAAc,SAAa,IAAA,UAAA,IAAc,SAAW,EAAA;AACtD,UAAO,OAAA,UAAA,CAAA;AAAA,SACT,MAAA,IAAW,YAAY,SAAW,EAAA;AAChC,UAAO,OAAA,SAAA,CAAA;AAAA,SACT,MAAA,IAAW,aAAa,SAAW,EAAA;AACjC,UAAO,OAAA,SAAA,CAAA;AAAA,SACF,MAAA;AACL,UAAO,OAAA,SAAA,CAAA;AAAA,SACT;AAAA,KAAA;AAAA,GAEN;AAAA,EAEA,YAAA,EAAc,CACZ,EAAE,SAAW,EAAA,MAAA,EAAQ,QAAS,EAAA,EAC9B,QACA,EAAA,KAAA,EACA,SACA,EAAA,CAAA,EACA,cACW,KAAA;AACX,IAAA,MAAA,GAAS,OAAO,MAAM,CAAA,CAAA;AACtB,IAAA,MAAM,gBAAgB,IAAK,CAAA,GAAA,CAAI,CAAG,EAAA,QAAA,GAAY,YAAuB,MAAM,CAAA,CAAA;AAC3E,IAAA,MAAM,SAAY,GAAA,IAAA,CAAK,GAAI,CAAA,aAAA,EAAe,WAAY,SAAoB,CAAA,CAAA;AAC1E,IAAA,MAAM,YAAY,IAAK,CAAA,GAAA;AAAA,MACrB,CAAA;AAAA,MACA,QAAA,GAAY,SACV,GAAA,MAAA,GACA,cACC,GAAA,SAAA;AAAA,KACL,CAAA;AAEA,IAAA,IAAI,UAAUI,wBAAiB,EAAA;AAC7B,MAAA,IAAI,SAAa,IAAA,SAAA,GAAY,MAAU,IAAA,SAAA,IAAa,YAAY,MAAQ,EAAA;AACtE,QAAQ,KAAA,GAAAJ,uBAAA,CAAA;AAAA,OACH,MAAA;AACL,QAAQ,KAAA,GAAAC,2BAAA,CAAA;AAAA,OACV;AAAA,KACF;AAEA,IAAQ,QAAA,KAAA;AAAA,MACD,KAAAC,wBAAA;AACH,QAAO,OAAA,SAAA,CAAA;AAAA,MACJ,KAAAC,sBAAA;AACH,QAAO,OAAA,SAAA,CAAA;AAAA,MAAA,KACJF,2BAAoB,EAAA;AACvB,QAAA,MAAM,eAAe,IAAK,CAAA,KAAA,CAAM,SAAa,GAAA,CAAA,SAAA,GAAY,aAAa,CAAC,CAAA,CAAA;AACvE,QAAA,IAAI,YAAe,GAAA,IAAA,CAAK,IAAK,CAAA,MAAA,GAAS,CAAC,CAAG,EAAA;AACxC,UAAO,OAAA,CAAA,CAAA;AAAA,mBACE,YAAe,GAAA,aAAA,GAAgB,KAAK,KAAM,CAAA,MAAA,GAAS,CAAC,CAAG,EAAA;AAChE,UAAO,OAAA,aAAA,CAAA;AAAA,SACF,MAAA;AACL,UAAO,OAAA,YAAA,CAAA;AAAA,SACT;AAAA,OACF;AAAA,MACK,KAAAD,uBAAA,CAAA;AAAA,MAAA;AAEH,QAAI,IAAA,SAAA,IAAa,SAAa,IAAA,SAAA,IAAa,SAAW,EAAA;AACpD,UAAO,OAAA,SAAA,CAAA;AAAA,SACT,MAAA,IAAW,YAAY,SAAW,EAAA;AAChC,UAAO,OAAA,SAAA,CAAA;AAAA,SACT,MAAA,IAAW,YAAY,SAAW,EAAA;AAChC,UAAO,OAAA,SAAA,CAAA;AAAA,SACF,MAAA;AACL,UAAO,OAAA,SAAA,CAAA;AAAA,SACT;AAAA,KAAA;AAAA,GAEN;AAAA,EAEA,8BAA8B,CAAC,EAAE,aAAa,WAAY,EAAA,EAAG,eAC3D,IAAK,CAAA,GAAA;AAAA,IACH,CAAA;AAAA,IACA,IAAK,CAAA,GAAA;AAAA,MACH,WAAc,GAAA,CAAA;AAAA,MACd,IAAA,CAAK,KAAM,CAAA,UAAA,GAAc,WAAsB,CAAA;AAAA,KACjD;AAAA,GACF;AAAA,EAEF,+BAAA,EAAiC,CAC/B,EAAE,WAAA,EAAa,aAAa,KAAM,EAAA,EAClC,YACA,UACW,KAAA;AACX,IAAA,MAAM,OAAO,UAAc,GAAA,WAAA,CAAA;AAC3B,IAAA,MAAM,sBAAsB,IAAK,CAAA,IAAA;AAAA,MAC7B,CAAA,KAAA,GAAmB,aAAa,IAAS,IAAA,WAAA;AAAA,KAC7C,CAAA;AACA,IAAA,OAAO,IAAK,CAAA,GAAA;AAAA,MACV,CAAA;AAAA,MACA,KAAK,GAAI,CAAA,WAAA,GAAc,CAAG,EAAA,UAAA,GAAa,sBAAsB,CAAC,CAAA;AAAA,KAChE,CAAA;AAAA,GACF;AAAA,EAEA,2BAA2B,CACzB,EAAE,WAAW,QAAS,EAAA,EACtB,cAEA,IAAK,CAAA,GAAA;AAAA,IACH,CAAA;AAAA,IACA,IAAA,CAAK,IAAI,QAAW,GAAA,CAAA,EAAG,KAAK,KAAM,CAAA,SAAA,GAAa,SAAoB,CAAC,CAAA;AAAA,GACtE;AAAA,EAEF,4BAAA,EAA8B,CAC5B,EAAE,SAAA,EAAW,UAAU,MAAO,EAAA,EAC9B,YACA,SACW,KAAA;AACX,IAAA,MAAM,MAAM,UAAc,GAAA,SAAA,CAAA;AAC1B,IAAA,MAAM,iBAAiB,IAAK,CAAA,IAAA;AAAA,MACxB,CAAA,MAAA,GAAoB,YAAY,GAAQ,IAAA,SAAA;AAAA,KAC5C,CAAA;AACA,IAAA,OAAO,IAAK,CAAA,GAAA;AAAA,MACV,CAAA;AAAA,MACA,IAAK,CAAA,GAAA;AAAA,QACH,QAAW,GAAA,CAAA;AAAA,QACX,aAAa,cAAiB,GAAA,CAAA;AAAA,OAChC;AAAA,KACF,CAAA;AAAA,GACF;AAAA,EAKA,WAAW,MAAM,KAAA,CAAA;AAAA,EAEjB,UAAY,EAAA,IAAA;AAAA,EAEZ,aAAe,EAAA,CAAC,EAAE,WAAA,EAAa,WAAgB,KAAA;AAC7C,IAAI,IAAA,OAAA,CAAQ,GAAI,CAAA,QAAA,KAAa,YAAc,EAAA;AACzC,MAAI,IAAA,CAACK,cAAS,CAAA,WAAW,CAAG,EAAA;AAC1B,QAAAC,gBAAA;AAAA,UACE,KAAA;AAAA,UACA,CAAA;AAAA;AAAA,oBAAA,EAEY,OAAO,WAAA,CAAA;AAAA,QAAA,CAAA;AAAA,SAErB,CAAA;AAAA,OACF;AAEA,MAAI,IAAA,CAACD,cAAS,CAAA,SAAS,CAAG,EAAA;AACxB,QAAAC,gBAAA;AAAA,UACE,KAAA;AAAA,UACA,CAAA;AAAA;AAAA,oBAAA,EAEY,OAAO,SAAA,CAAA;AAAA,QAAA,CAAA;AAAA,SAErB,CAAA;AAAA,OACF;AAAA,KACF;AAAA,GACF;AACF,CAAC;;;;"}