{"version":3,"file":"directive.js","sources":["../../../../../../packages/components/loading/src/directive.ts"],"sourcesContent":["// @ts-nocheck\nimport { isRef, ref } from 'vue'\nimport { hyphenate, isObject, isString } from '@element-plus/utils'\nimport Loading from './service'\n\nimport type { Directive, DirectiveBinding, UnwrapRef } from 'vue'\nimport type { LoadingOptions } from './types'\nimport type { LoadingInstance } from './loading'\n\nconst INSTANCE_KEY = Symbol('ElLoading')\nconst getAttributeName = (name: string) => {\n  return `element-loading-${hyphenate(name)}`\n}\n\nexport type LoadingBinding = boolean | UnwrapRef<LoadingOptions>\nexport interface ElementLoading extends HTMLElement {\n  [INSTANCE_KEY]?: {\n    instance: LoadingInstance\n    options: LoadingOptions\n  }\n}\n\nconst createInstance = (\n  el: ElementLoading,\n  binding: DirectiveBinding<LoadingBinding>\n) => {\n  const vm = binding.instance\n\n  const getBindingProp = <K extends keyof LoadingOptions>(\n    key: K\n  ): LoadingOptions[K] =>\n    isObject(binding.value) ? binding.value[key] : undefined\n\n  const resolveExpression = (key: any) => {\n    const data = (isString(key) && vm?.[key]) || key\n    return ref(data)\n  }\n\n  const getProp = <K extends keyof LoadingOptions>(name: K) =>\n    resolveExpression(\n      getBindingProp(name) || el.getAttribute(getAttributeName(name))\n    )\n\n  const fullscreen =\n    getBindingProp('fullscreen') ?? binding.modifiers.fullscreen\n\n  const options: LoadingOptions = {\n    text: getProp('text'),\n    svg: getProp('svg'),\n    svgViewBox: getProp('svgViewBox'),\n    spinner: getProp('spinner'),\n    background: getProp('background'),\n    customClass: getProp('customClass'),\n    fullscreen,\n    target: getBindingProp('target') ?? (fullscreen ? undefined : el),\n    body: getBindingProp('body') ?? binding.modifiers.body,\n    lock: getBindingProp('lock') ?? binding.modifiers.lock,\n  }\n  const instance = Loading(options)\n  instance._context = vLoading._context\n  el[INSTANCE_KEY] = {\n    options,\n    instance,\n  }\n}\n\nconst updateOptions = (\n  originalOptions: LoadingOptions,\n  newOptions: UnwrapRef<LoadingOptions>\n) => {\n  for (const key of Object.keys(originalOptions)) {\n    if (isRef(originalOptions[key]))\n      originalOptions[key].value = newOptions[key]\n  }\n}\n\nconst vLoading: Directive<ElementLoading, LoadingBinding> = {\n  mounted(el, binding) {\n    if (binding.value) {\n      createInstance(el, binding)\n    }\n  },\n  updated(el, binding) {\n    const instance = el[INSTANCE_KEY]\n    if (!binding.value) {\n      instance?.instance.close()\n      el[INSTANCE_KEY] = null\n      return\n    }\n\n    if (!instance) createInstance(el, binding)\n    else {\n      updateOptions(\n        instance.options,\n        isObject(binding.value)\n          ? binding.value\n          : {\n              text: el.getAttribute(getAttributeName('text')),\n              svg: el.getAttribute(getAttributeName('svg')),\n              svgViewBox: el.getAttribute(getAttributeName('svgViewBox')),\n              spinner: el.getAttribute(getAttributeName('spinner')),\n              background: el.getAttribute(getAttributeName('background')),\n              customClass: el.getAttribute(getAttributeName('customClass')),\n            }\n      )\n    }\n  },\n  unmounted(el) {\n    el[INSTANCE_KEY]?.instance.close()\n    el[INSTANCE_KEY] = null\n  },\n}\n\nvLoading._context = null\nexport default vLoading\n"],"names":["hyphenate","isObject","isString","ref","Loading","isRef"],"mappings":"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"}