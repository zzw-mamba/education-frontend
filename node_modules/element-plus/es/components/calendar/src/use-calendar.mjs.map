{"version":3,"file":"use-calendar.mjs","sources":["../../../../../../packages/components/calendar/src/use-calendar.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport dayjs from 'dayjs'\nimport { useLocale } from '@element-plus/hooks'\nimport { debugWarn, isArray, isDate } from '@element-plus/utils'\nimport { INPUT_EVENT, UPDATE_MODEL_EVENT } from '@element-plus/constants'\n\nimport type { ComputedRef, SetupContext } from 'vue'\nimport type { Dayjs } from 'dayjs'\nimport type { CalendarDateType, CalendarEmits, CalendarProps } from './calendar'\n\nconst adjacentMonth = (start: Dayjs, end: Dayjs): [Dayjs, Dayjs][] => {\n  const firstMonthLastDay = start.endOf('month')\n  const lastMonthFirstDay = end.startOf('month')\n\n  // Whether the last day of the first month and the first day of the last month is in the same week\n  const isSameWeek = firstMonthLastDay.isSame(lastMonthFirstDay, 'week')\n  const lastMonthStartDay = isSameWeek\n    ? lastMonthFirstDay.add(1, 'week')\n    : lastMonthFirstDay\n\n  return [\n    [start, firstMonthLastDay],\n    [lastMonthStartDay.startOf('week'), end],\n  ]\n}\n\nconst threeConsecutiveMonth = (start: Dayjs, end: Dayjs): [Dayjs, Dayjs][] => {\n  const firstMonthLastDay = start.endOf('month')\n  const secondMonthFirstDay = start.add(1, 'month').startOf('month')\n\n  // Whether the last day of the first month and the second month is in the same week\n  const secondMonthStartDay = firstMonthLastDay.isSame(\n    secondMonthFirstDay,\n    'week'\n  )\n    ? secondMonthFirstDay.add(1, 'week')\n    : secondMonthFirstDay\n\n  const secondMonthLastDay = secondMonthStartDay.endOf('month')\n  const lastMonthFirstDay = end.startOf('month')\n\n  // Whether the last day of the second month and the last day of the last month is in the same week\n  const lastMonthStartDay = secondMonthLastDay.isSame(lastMonthFirstDay, 'week')\n    ? lastMonthFirstDay.add(1, 'week')\n    : lastMonthFirstDay\n\n  return [\n    [start, firstMonthLastDay],\n    [secondMonthStartDay.startOf('week'), secondMonthLastDay],\n    [lastMonthStartDay.startOf('week'), end],\n  ]\n}\n\nexport const useCalendar = (\n  props: CalendarProps,\n  emit: SetupContext<CalendarEmits>['emit'],\n  componentName: string\n) => {\n  const { lang } = useLocale()\n\n  const selectedDay = ref<Dayjs>()\n  const now = dayjs().locale(lang.value)\n\n  const realSelectedDay = computed<Dayjs | undefined>({\n    get() {\n      if (!props.modelValue) return selectedDay.value\n      return date.value\n    },\n    set(val) {\n      if (!val) return\n      selectedDay.value = val\n      const result = val.toDate()\n\n      emit(INPUT_EVENT, result)\n      emit(UPDATE_MODEL_EVENT, result)\n    },\n  })\n\n  // if range is valid, we get a two-digit array\n  const validatedRange = computed(() => {\n    if (\n      !props.range ||\n      !isArray(props.range) ||\n      props.range.length !== 2 ||\n      props.range.some((item) => !isDate(item))\n    )\n      return []\n    const rangeArrDayjs = props.range.map((_) => dayjs(_).locale(lang.value))\n    const [startDayjs, endDayjs] = rangeArrDayjs\n    if (startDayjs.isAfter(endDayjs)) {\n      debugWarn(componentName, 'end time should be greater than start time')\n      return []\n    }\n    if (startDayjs.isSame(endDayjs, 'month')) {\n      // same month\n      return calculateValidatedDateRange(startDayjs, endDayjs)\n    } else {\n      // two months\n      if (startDayjs.add(1, 'month').month() !== endDayjs.month()) {\n        debugWarn(\n          componentName,\n          'start time and end time interval must not exceed two months'\n        )\n        return []\n      }\n      return calculateValidatedDateRange(startDayjs, endDayjs)\n    }\n  })\n\n  const date: ComputedRef<Dayjs> = computed(() => {\n    if (!props.modelValue) {\n      return (\n        realSelectedDay.value ||\n        (validatedRange.value.length ? validatedRange.value[0][0] : now)\n      )\n    } else {\n      return dayjs(props.modelValue).locale(lang.value)\n    }\n  })\n  const prevMonthDayjs = computed(() => date.value.subtract(1, 'month').date(1))\n  const nextMonthDayjs = computed(() => date.value.add(1, 'month').date(1))\n  const prevYearDayjs = computed(() => date.value.subtract(1, 'year').date(1))\n  const nextYearDayjs = computed(() => date.value.add(1, 'year').date(1))\n\n  // https://github.com/element-plus/element-plus/issues/3155\n  // Calculate the validate date range according to the start and end dates\n  const calculateValidatedDateRange = (\n    startDayjs: Dayjs,\n    endDayjs: Dayjs\n  ): [Dayjs, Dayjs][] => {\n    const firstDay = startDayjs.startOf('week')\n    const lastDay = endDayjs.endOf('week')\n    const firstMonth = firstDay.get('month')\n    const lastMonth = lastDay.get('month')\n\n    // Current mouth\n    if (firstMonth === lastMonth) {\n      return [[firstDay, lastDay]]\n    }\n    // Two adjacent months\n    else if ((firstMonth + 1) % 12 === lastMonth) {\n      return adjacentMonth(firstDay, lastDay)\n    }\n    // Three consecutive months (compatible: 2021-01-30 to 2021-02-28)\n    else if (\n      firstMonth + 2 === lastMonth ||\n      (firstMonth + 1) % 11 === lastMonth\n    ) {\n      return threeConsecutiveMonth(firstDay, lastDay)\n    }\n    // Other cases\n    else {\n      debugWarn(\n        componentName,\n        'start time and end time interval must not exceed two months'\n      )\n      return []\n    }\n  }\n\n  const pickDay = (day: Dayjs) => {\n    realSelectedDay.value = day\n  }\n\n  const selectDate = (type: CalendarDateType) => {\n    const dateMap: Record<CalendarDateType, Dayjs> = {\n      'prev-month': prevMonthDayjs.value,\n      'next-month': nextMonthDayjs.value,\n      'prev-year': prevYearDayjs.value,\n      'next-year': nextYearDayjs.value,\n      today: now,\n    }\n\n    const day = dateMap[type]\n\n    if (!day.isSame(date.value, 'day')) {\n      pickDay(day)\n    }\n  }\n\n  const handleDateChange = (date: Dayjs | 'today') => {\n    if (date === 'today') {\n      selectDate('today')\n    } else {\n      pickDay(date)\n    }\n  }\n\n  return {\n    calculateValidatedDateRange,\n    date,\n    realSelectedDay,\n    pickDay,\n    selectDate,\n    validatedRange,\n    handleDateChange,\n  }\n}\n"],"names":["date"],"mappings":"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"}