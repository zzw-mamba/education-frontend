{"version":3,"file":"helper.mjs","sources":["../../../../../../packages/components/mention/src/helper.ts"],"sourcesContent":["import { ensureArray, isFirefox } from '@element-plus/utils'\n\nimport type { MentionCtx, MentionOption } from './types'\n\nexport const filterOption = (\n  pattern: string,\n  option: MentionOption\n): boolean => {\n  const lowerCase = pattern.toLowerCase()\n  const label = option.label || option.value || ''\n  return label.toLowerCase().includes(lowerCase)\n}\n\nexport const getMentionCtx = (\n  inputEl: HTMLInputElement | HTMLTextAreaElement,\n  prefix: string | string[],\n  split: string\n) => {\n  const { selectionEnd } = inputEl\n  if (selectionEnd === null) return\n  const inputValue = inputEl.value\n  const prefixArray = ensureArray(prefix)\n  let splitIndex = -1\n  let mentionCtx: MentionCtx | undefined\n  for (let i = selectionEnd - 1; i >= 0; --i) {\n    const char = inputValue[i]\n    if (char === split || char === '\\n' || char === '\\r') {\n      splitIndex = i\n      continue\n    }\n    if (prefixArray.includes(char)) {\n      const end = splitIndex === -1 ? selectionEnd : splitIndex\n      const pattern = inputValue.slice(i + 1, end)\n      mentionCtx = {\n        pattern,\n        start: i + 1,\n        end,\n        prefix: char,\n        prefixIndex: i,\n        splitIndex,\n        selectionEnd,\n      }\n      break\n    }\n  }\n  return mentionCtx\n}\n\n/**\n * fork from textarea-caret-position\n * https://github.com/component/textarea-caret-position\n * The MIT License (MIT)\n * Copyright (c) 2015 Jonathan Ong me@jongleberry.com\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nexport const getCursorPosition = (\n  element: HTMLInputElement | HTMLTextAreaElement,\n  options = {\n    debug: false,\n    useSelectionEnd: false,\n  }\n) => {\n  const selectionStart =\n    element.selectionStart !== null ? element.selectionStart : 0\n  const selectionEnd = element.selectionEnd !== null ? element.selectionEnd : 0\n  const position = options.useSelectionEnd ? selectionEnd : selectionStart\n  // We'll copy the properties below into the mirror div.\n  // Note that some browsers, such as Firefox, do not concatenate properties\n  // into their shorthand (e.g. padding-top, padding-bottom etc. -> padding),\n  // so we have to list every single property explicitly.\n  const properties: string[] = [\n    'direction', // RTL support\n    'boxSizing',\n    'width', // on Chrome and IE, exclude the scrollbar, so the mirror div wraps exactly as the textarea does\n    'height',\n    'overflowX',\n    'overflowY', // copy the scrollbar for IE\n    'borderTopWidth',\n    'borderRightWidth',\n    'borderBottomWidth',\n    'borderLeftWidth',\n    'borderStyle',\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft',\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/font\n    'fontStyle',\n    'fontVariant',\n    'fontWeight',\n    'fontStretch',\n    'fontSize',\n    'fontSizeAdjust',\n    'lineHeight',\n    'fontFamily',\n    'textAlign',\n    'textTransform',\n    'textIndent',\n    'textDecoration', // might not make a difference, but better be safe\n    'letterSpacing',\n    'wordSpacing',\n    'tabSize',\n    'MozTabSize',\n  ]\n\n  if (options.debug) {\n    const el = document.querySelector(\n      '#input-textarea-caret-position-mirror-div'\n    )\n    if (el?.parentNode) el.parentNode.removeChild(el)\n  }\n\n  // The mirror div will replicate the textareas style\n  const div = document.createElement('div')\n  div.id = 'input-textarea-caret-position-mirror-div'\n  document.body.appendChild(div)\n\n  const style = div.style\n  const computed = window.getComputedStyle(element)\n\n  const isInput = element.nodeName === 'INPUT'\n\n  // Default textarea styles\n  style.whiteSpace = isInput ? 'nowrap' : 'pre-wrap'\n  if (!isInput) style.wordWrap = 'break-word' // only for textarea-s\n\n  // Position off-screen\n  style.position = 'absolute' // required to return coordinates properly\n  if (!options.debug) style.visibility = 'hidden' // not 'display: none' because we want rendering\n\n  // Transfer the element's properties to the div\n  properties.forEach((prop) => {\n    if (isInput && prop === 'lineHeight') {\n      // Special case for <input>s because text is rendered centered and line height may be != height\n      if (computed.boxSizing === 'border-box') {\n        const height = Number.parseInt(computed.height as string)\n        const outerHeight =\n          Number.parseInt(computed.paddingTop as string) +\n          Number.parseInt(computed.paddingBottom as string) +\n          Number.parseInt(computed.borderTopWidth as string) +\n          Number.parseInt(computed.borderBottomWidth as string)\n        const targetHeight =\n          outerHeight + Number.parseInt(computed.lineHeight as string)\n        if (height > targetHeight) {\n          style.lineHeight = `${height - outerHeight}px`\n        } else if (height === targetHeight) {\n          style.lineHeight = computed.lineHeight\n        } else {\n          style.lineHeight = '0'\n        }\n      } else {\n        style.lineHeight = computed.height\n      }\n    } else {\n      style[prop as any] = computed[prop as any]\n    }\n  })\n\n  if (isFirefox()) {\n    // Firefox lies about the overflow property for textareas: https://bugzilla.mozilla.org/show_bug.cgi?id=984275\n    if (element.scrollHeight > Number.parseInt(computed.height as string)) {\n      style.overflowY = 'scroll'\n    }\n  } else {\n    style.overflow = 'hidden' // for Chrome to not render a scrollbar; IE keeps overflowY = 'scroll'\n  }\n\n  div.textContent = element.value.slice(0, Math.max(0, position))\n  // The second special handling for input type=\"text\" vs textarea:\n  // spaces need to be replaced with non-breaking spaces - http://stackoverflow.com/a/13402035/1269037\n  if (isInput && div.textContent) {\n    div.textContent = div.textContent.replace(/\\s/g, '\\u00A0')\n  }\n\n  const span = document.createElement('span')\n  // Wrapping must be replicated *exactly*, including when a long word gets\n  // onto the next line, with whitespace at the end of the line before (#7).\n  // The  *only* reliable way to do that is to copy the *entire* rest of the\n  // textareas content into the <span> created at the caret position.\n  // For inputs, just '.' would be enough, but no need to bother.\n  span.textContent = element.value.slice(Math.max(0, position)) || '.' // || because a completely empty faux span doesn't render at all\n  span.style.position = 'relative'\n  span.style.left = `${-element.scrollLeft}px`\n  span.style.top = `${-element.scrollTop}px`\n  div.appendChild(span)\n\n  const relativePosition = {\n    top: span.offsetTop + Number.parseInt(computed.borderTopWidth as string),\n    left: span.offsetLeft + Number.parseInt(computed.borderLeftWidth as string),\n    // We don't use line-height since it may be too large for position. Eg. 34px\n    // for input\n    height: Number.parseInt(computed.fontSize as string) * 1.5,\n  }\n\n  if (options.debug) {\n    span.style.backgroundColor = '#aaa'\n  } else {\n    document.body.removeChild(div)\n  }\n\n  if (relativePosition.left >= element.clientWidth) {\n    relativePosition.left = element.clientWidth\n  }\n  return relativePosition\n}\n"],"names":["ensureArray"],"mappings":"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"}