{"version":3,"file":"only-child.mjs","sources":["../../../../../../packages/components/slot/src/only-child.tsx"],"sourcesContent":["import {\n  Comment,\n  Fragment,\n  Text,\n  cloneVNode,\n  defineComponent,\n  inject,\n  withDirectives,\n} from 'vue'\nimport { NOOP, debugWarn, isObject } from '@element-plus/utils'\nimport {\n  FORWARD_REF_INJECTION_KEY,\n  useForwardRefDirective,\n  useNamespace,\n} from '@element-plus/hooks'\n\nimport type { Ref, VNode } from 'vue'\n\nconst NAME = 'ElOnlyChild'\n\nexport const OnlyChild = defineComponent({\n  name: NAME,\n  setup(_, { slots, attrs }) {\n    const forwardRefInjection = inject(FORWARD_REF_INJECTION_KEY)\n    const forwardRefDirective = useForwardRefDirective(\n      forwardRefInjection?.setForwardRef ?? NOOP\n    )\n    return () => {\n      const defaultSlot = slots.default?.(attrs)\n      if (!defaultSlot) return null\n      const [firstLegitNode, length] = findFirstLegitChild(defaultSlot)\n\n      if (!firstLegitNode) {\n        debugWarn(NAME, 'no valid child node found')\n        return null\n      }\n      if (length > 1) {\n        debugWarn(NAME, 'requires exact only one valid child.')\n      }\n\n      return withDirectives(cloneVNode(firstLegitNode!, attrs), [\n        [forwardRefDirective],\n      ])\n    }\n  },\n})\n\nfunction findFirstLegitChild(\n  node: VNode[] | undefined\n): [VNode | null, number] {\n  if (!node) return [null, 0]\n  const children = node as VNode[]\n  const len = children.filter((c) => c.type !== Comment).length\n\n  for (const child of children) {\n    /**\n     * when user uses h(Fragment, [text]) to render plain string,\n     * this switch case just cannot handle, when the value is primitives\n     * we should just return the wrapped string\n     */\n    if (isObject(child)) {\n      switch (child.type) {\n        case Comment:\n          continue\n        case Text:\n        case 'svg':\n          return [wrapTextContent(child), len]\n        case Fragment:\n          return findFirstLegitChild(child.children as VNode[])\n        default:\n          return [child, len]\n      }\n    }\n    return [wrapTextContent(child), len]\n  }\n  return [null, 0]\n}\n\nfunction wrapTextContent(s: string | VNode) {\n  const ns = useNamespace('only-child')\n  return <span class={ns.e('content')}>{s}</span>\n}\n\nexport type OnlyChildExpose = {\n  forwardRef: Ref<HTMLElement>\n}\n"],"names":["NAME","OnlyChild","defineComponent","name","setup","_","slots","attrs","forwardRefInjection","inject","FORWARD_REF_INJECTION_KEY","forwardRefDirective","useForwardRefDirective","setForwardRef","NOOP","_a","defaultSlot","default","firstLegitNode","length","findFirstLegitChild","debugWarn","withDirectives","cloneVNode","node","children","len","filter","c","type","Comment","child","isObject","Text","wrapTextContent","Fragment","s","ns","useNamespace","_createVNode","e"],"mappings":"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"}